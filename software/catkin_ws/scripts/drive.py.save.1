
#!/usr/bin/env python

# This is a proof of concept for o-drve based throttle. 

import rospy
from sensor_msgs.msg import Joy
import odrive

INDEX_PAN = 3
INDEX_SPEED = 4

MAX_SPEED = 50000

engine

def listener():
	print("Setting up listener")
	rospy.init_node('throttle',anonymous=True)

	rospy.Subscriber("/spacenav/joy", Joy, callback)
	
	print("spinning up listener")
	rospy.spin()
	print("listener down")

def callback(msg):
	speed = msg.axes[INDEX_PAN]
	speed = speed * MAX_SPEED #scale from to correct speeds.
	set_speed(int(speed))

def set_speed(speed):
        engine.axis0.controller.vel_setpoint = speed
	
def setup_odrive():
	engine = odrive.find_any()
	print(engine.vbus_voltage)
if __name__ == '__main__':
	
	listener()


